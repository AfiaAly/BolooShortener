{% extends 'base.html' %}

{% block content %}
    <div class="px-4 py-5 my-5 text-center">
        <h1 class="display-5 fw-bold">Shorten a link</h1>
        <form class="col-lg-6 mx-auto" method="POST" name="shorten" action="">
            <label for="url" class="visually-hidden">Enter a URL to shorten</label>
            <input type="text" id="url" class="form-control" placeholder="Enter a URL to shorten" required autofocus>
            <button class="w-100 btn btn-lg btn-primary my-4" type="button" onclick="send_ajax_call()">Shorten</button>
        </form>

{#    #}
    </div>
{% endblock %}

{% block script %}
<script type="text/javascript">
    function send_ajax_call() {
        let url = document.getElementById('url').value;
        $.ajax({
            url: '/shorten/',
            type: 'POST',
            data: {
                'url': url,
                'csrfmiddlewaretoken': '{{csrf_token}}',
            },
            success: function (response) {
                Swal.fire({
                    title: 'Shortened URL',
                    text: response.short_url,
                    icon: 'success',
                    confirmButtonText: 'Close'
                })
            },
            error: function (response) {
                Swal.fire({
                    title: 'Error',
                    text: response.responseJSON.error,
                    icon: 'error',
                    confirmButtonText: 'Close'
                })
            }
        })
    }
</script>
{% endblock %}
